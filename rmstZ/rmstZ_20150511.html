<!DOCTYPE html><html><head><meta http-equiv="Content-Type"content="text/html;charset=utf-8"/><style type="text/css">#divRoot{text-align:center;}#divTitle{clear:both;text-align:center;margin:16px;}#divOperateBin{text-align:center;margin:3px;display:none;}#divOperateXml{text-align:center;margin:3px;display:none;}#divOperateImd{text-align:center;margin:3px;display:none;}#divSelectImd{text-align:center;margin:3px;display:none;}#divSelectTxt{text-align:center;margin:3px;display:none;}#divOperateImg{text-align:center;margin:3px;display:none;}#divSave{text-align:center;margin:3px;display:none;}#divResult{margin:16px;}#divCopyright{clear:both;text-align:center;margin:16px;}</style></head><body><div id="divRoot"><div id="divTitle">rmstZ</div><div id="divFileReader"><input type="file"accept=".bin,.xml,.mde,.imd,.txt,.bmp,.jpg,.gif,.png,.mp3,"onchange="ReadFile(event)"/></div><div id="divOperate"><div id="divOperateBin"><select id="selectBinMode"onchange="SelectChanged()"><option value="xml"selected="selected">xml</option><option value="html">html</option></select></div><div id="divOperateXml"><select id="selectXmlbinMode"onchange="SelectChanged()"><option value="bin"selected="selected">bin</option><option value="html">html</option></select></div><div id="divOperateImd"><div id="divSelectImd"><select id="selectImdMode"onchange="SelectChanged()"><option value="png"selected="selected">png</option><option value="html">html</option><option value="txt">txt</option></select></div><div id="divSelectTxt"><select id="selectTxtMode"onchange="SelectChanged()"><option value="png"selected="selected">png</option><option value="html">html</option><option value="imd">imd</option></select></div><div id="divOptionImd1"><input type="checkbox"id="inputDrawBackground"checked="checked"onchange="CheckChanged()">背景色</input><input type="checkbox"id="inputDrawTrack"checked="checked"onchange="CheckChanged()">轨道线</input><input type="checkbox"id="inputDrawFrame"checked="checked"onchange="CheckChanged()">边框线</input></div><div id="divOptionImd2"><input type="checkbox"id="inputDrawBeat"checked="checked"onchange="CheckChanged()">节拍线</input><input type="checkbox"id="inputDrawCombo"checked="checked"onchange="CheckChanged()">连击数</input><input type="checkbox"id="inputDrawDetermine"checked="checked"onchange="CheckChanged()">判定线</input></div><div id="divOptionImd3"><select id="selectImdScaleX"onchange="SelectChanged()"><option value="1"selected="selected">128px</option><option value="2.5">320px</option><option value="5">640px</option><option value="7.5">960px</option></select><select id="selectImdScaleY"onchange="SelectChanged()"><option value="1">X1</option><option value="2">X2</option><option value="3">X3</option><option value="4"selected="selected">X4</option></select></div></div><div id="divOperateImg"><select id="selectImgMode"onchange="SelectChanged()"><option value="480×320"selected="selected">*.png</option><option value="140×60">*_title_ipad.png</option><option value="1024×768">*_ipad.png</option><option value="140×90">*_title_140_90.png</option></select></div></div><div id="divSave"><a id="aSave">保存</a></div><div id="divResult"></div><div id="divCopyright">Copyright © 心のsky Group</div></div><script type="text/javascript">var LittleEndian=(function(){var b=new ArrayBuffer(2);new DataView(b).setInt16(0,1,true);return new Int16Array(b)[0]===1;})();var SupportFileAPI=(function(){return!(typeof(window.File&&window.FileReader&&window.FileList&&window.Blob)==="undefined");})();var SupportCanvasAPI=(function(){return!(typeof document.createElement('canvas').getContext==="undefined");})();var SupportAudioAPI=(function(){return!(typeof(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContex)==="undefined");})();var IsUCBrowser=(function(){return(navigator.userAgent.indexOf("UCBrowser")!=-1);})();function GetFileName(n){var i=n.lastIndexOf(".");if(i!=-1){return n.substring(0,i);}
else{return"";}}
function GetFileExtension(n){var i=n.lastIndexOf(".");if(i!=-1){return n.substring(i+1).toLowerCase();}
else{return"";}}
function GetFileType(e,b){var r="";switch(e){case"xml":if(b.length>=37){switch(b[36]){case 0x20:r="bin";break;case 0x3F:r="mde";break;}}
break;default:r="";}
return r;}
function GetSelectValue(id){var s=document.getElementById(id);return s.options[s.selectedIndex].value;}
function OptimizeName(){var r=FileName;var i=r.indexOf("(");if(i!=-1){r=r.substring(0,i).trim();}
return r;}
function GetBinName(u){var r=[];var BinUnit=new Array(["errno_main_client",564],["mrock.active_client",35],["mrock.character_client",644],["mrock.characterproperty_client",327],["mrock.floornode_client",16],["mrock.floorreward_client",186],["mrock.innerpublicnotify_client",928],["mrock.innerrace_client",616],["mrock.luckyturntablereward_client",18],["mrock.luckyturntabletypeshow_client",137],["mrock.marketact_client",152],["mrock.mission_client",414],["mrock.scorebuy_client",22],["mrock.scoreexchange_client",21],["mrock.surviveact_client",263],["mrock.thingbuy_client",31],["mrock.timelimitcharacter_client",284],["mrock_buynew_client",295],["mrock_dailyactive_client",105],["mrock_guild_song_client",28],["mrock_guildactivity_client",332],["mrock_Map_client",57],["mrock_match_client",4156],["mrock_match_division_client",260],["mrock_medal_client",92],["mrock_noble_client",3993],["mrock_noble_gift_client",304],["mrock_papasong_client",361],["mrock_questconfig_client",640],["errno_main_client",564],["mrock_recharge_ios_client",406],["mrock_recharge_android_client",406],["mrock_room_client",24],["mrock_scoreexchange_client",21],["mrock_share_client",268],["mrock_song_client",830],["mrock_song_client_android",830],["mrock_songlevel_client",830],["mrock_SongPkg_client",808],["mrock_starmall_exchange_client",93],["mrock_SysParam_client",8],["mrock_txt_client",260]);for(var i=0;i<BinUnit.length;i++){if(BinUnit[i][1]==u){r.push(BinUnit[i][0]);}}
return r;}
function GetBinStructure(){var r=[];switch(OptimizeName()){case"errno_main_client":r.push(new Array(0,"m_szName",48));r.push(new Array(0,"m_uiValue",4));r.push(new Array(0,"m_szDescriptionZH",256));r.push(new Array(0,"m_szDescriptionEN",256));return new Array("ErrnoConfig_Client_Tab","ErrnoConfig_Client",r);break;case"mrock.active_client":r.push(new Array(0,"m_ushActiveID",2));r.push(new Array(0,"m_ucActiveType",1));r.push(new Array(0,"m_iNumber",4));r.push(new Array(0,"m_ucRewardNumber",1));r.push(new Array(1,"m_astReward,ActiveReward",3));return new Array("ActiveConfig_Client_Tab","ActiveConfig_Client",r);break;case"mrock.character_client":r.push(new Array(0,"m_usID",2));r.push(new Array(0,"m_usIconID",2));r.push(new Array(0,"m_szDesc",256));r.push(new Array(0,"m_szNoteDesc",256));r.push(new Array(0,"m_szNoteStyle1",32));r.push(new Array(0,"m_szNoteStyle2",32));r.push(new Array(0,"m_szNoteStyle3",32));r.push(new Array(0,"m_szGameSpeaking",32));return new Array("CharacterConfig_Client_Tab","CharacterConfig_Client",r);break;case"mrock.characterproperty_client":r.push(new Array(0,"m_usID",2));r.push(new Array(0,"m_ucPropertyID",1));r.push(new Array(0,"m_ucType",1));r.push(new Array(0,"m_usIconID",2));r.push(new Array(0,"m_ucEffectType",1));r.push(new Array(0,"m_szName",32));r.push(new Array(0,"m_szEffect",32));r.push(new Array(0,"m_szDesc",256));return new Array("CharacterPropertyConfig_Client_Tab","CharacterPropertyConfig_Client",r);break;case"mrock.floornode_client":r.push(new Array(0,"m_iNodeID",4));r.push(new Array(0,"m_iNodeType",4));r.push(new Array(0,"m_iNodeValue",4));r.push(new Array(0,"m_iPlayStyle",4));return new Array("FloorNodeConfig_Client_Tab","FloorNodeConfig_Client",r);break;case"mrock.floorreward_client":r.push(new Array(0,"m_iRewardID",4));r.push(new Array(0,"m_ucRewardType",1));r.push(new Array(0,"m_iRewardValue",4));return new Array("FloorRewardConfig_Client_Tab","FloorRewardConfig_Client",r);break;case"mrock.innerpublicnotify_client":r.push(new Array(0,"m_iID",4));r.push(new Array(0,"m_iLevel",4));r.push(new Array(0,"m_iLinkType",4));r.push(new Array(0,"m_iContentType",4));r.push(new Array(0,"m_szTitle",300));r.push(new Array(0,"m_szContent",300));r.push(new Array(0,"m_szUrl",300));r.push(new Array(0,"m_iForce",4));r.push(new Array(0,"m_iPhonetype",4));r.push(new Array(0,"m_iLoginType",4));return new Array("InnerPublicNotifyConfig_Client_Tab","InnerPublicNotifyConfig_Client",r);break;case"mrock.innerrace_client":r.push(new Array(0,"m_iMatchID",4));r.push(new Array(0,"m_iLevel",4));r.push(new Array(0,"m_iContentType",4));r.push(new Array(0,"m_szTitle",300));r.push(new Array(0,"m_szContent",300));r.push(new Array(0,"m_iPhonetype",4));return new Array("InnerRaceConfig_Client_Tab","InnerRaceConfig_Client",r);break;case"mrock.luckyturntablereward_client":break;case"mrock.luckyturntabletypeshow_client":break;case"mrock.marketact_client":r.push(new Array(0,"m_ushMarketActID",2));r.push(new Array(0,"m_szDescription",128));r.push(new Array(0,"m_ucRewardNumber",1));r.push(new Array(1,"m_astReward,MarketActReward",3));return new Array("MarketActConfig_Client_Tab","MarketActConfig_Client",r);break;case"mrock.mission_client":r.push(new Array(0,"m_iMissionID",4));r.push(new Array(0,"m_szTitle",128));r.push(new Array(0,"m_iIconID",4));r.push(new Array(0,"m_szDiffDesc",64));r.push(new Array(0,"m_szDiffColor",64));r.push(new Array(0,"m_szBeginTime",64));r.push(new Array(0,"m_szEndTime",64));r.push(new Array(0,"m_iStartFloor",4));r.push(new Array(0,"m_iEndFloor",4));r.push(new Array(0,"m_ucResetable",4));r.push(new Array(0,"m_iResetCost",4));r.push(new Array(0,"m_ucRewardType",1));r.push(new Array(0,"m_ucIsNew",1));r.push(new Array(0,"m_iSeqID",4));return new Array("MissionConfig_Client_Tab","MissionConfig_Client",r);break;case"mrock.scorebuy_client":r.push(new Array(0,"m_iBuyID",4));r.push(new Array(0,"m_ucItemType",1));r.push(new Array(0,"m_iItemID",4));r.push(new Array(0,"m_iItemValue",4));r.push(new Array(0,"m_iScorePresent",4));r.push(new Array(0,"m_ucBuyType",1));r.push(new Array(0,"m_iCostNum",4));return new Array("ScoreBuyConfig_Client_Tab","ScoreBuyConfig_Client",r);break;case"mrock.scoreexchange_client":case"mrock_scoreexchange_client":r.push(new Array(0,"m_iExchangeID",4));r.push(new Array(0,"m_ucItemType",1));r.push(new Array(0,"m_iItemID",4));r.push(new Array(0,"m_iItemValue",4));r.push(new Array(0,"m_iScoreCost",4));r.push(new Array(0,"m_iVersion",4));return new Array("ScoreExchangeConfig_Client_Tab","ScoreExchangeConfig_Client",r);break;case"mrock.surviveact_client":r.push(new Array(0,"m_iID",4));r.push(new Array(0,"m_ushSongID",2));r.push(new Array(0,"m_ucNoteType",1));r.push(new Array(0,"m_szOpenTimeDesc",256));return new Array("SurviveActConfig_Client_Tab","SurviveActConfig_Client",r);break;case"mrock.thingbuy_client":break;case"mrock.timelimitcharacter_client":r.push(new Array(0,"m_ushID",2));r.push(new Array(0,"m_ushCharacterID",2));r.push(new Array(0,"m_ushInitLevel",2));r.push(new Array(0,"m_szName",22));r.push(new Array(0,"m_szDesc",256));return new Array("TimeLimitCharacterConfig_Client_Tab","TimeLimitCharacterConfig_Client",r);break;case"mrock_buynew_client":r.push(new Array(0,"m_ushID",2));r.push(new Array(0,"m_ucType",1));r.push(new Array(0,"m_iThingID",4));r.push(new Array(0,"m_szItemName",128));r.push(new Array(0,"m_iThingNumber",4));r.push(new Array(0,"m_iIOSMoney",4));r.push(new Array(0,"m_iAndroidMoney",4));r.push(new Array(0,"m_iDiamonds",4));r.push(new Array(0,"m_szDescriptionName",128));r.push(new Array(0,"m_iIconID",4));r.push(new Array(0,"m_iIsopen",4));r.push(new Array(0,"m_iSequence",4));r.push(new Array(0,"m_iIsone",4));return new Array("BuyConfig_Client_Tab","BuyConfig_Client",r);break;case"mrock_dailyactive_client":break;case"mrock_guild_song_client":break;case"mrock_guildactivity_client":break;case"mrock_Map_client":break;case"mrock_match_client":r.push(new Array(0,"m_iMatchIndex",4));r.push(new Array(0,"m_iRegion",4));r.push(new Array(0,"m_iType",4));r.push(new Array(0,"m_szBeginTime",64));r.push(new Array(0,"m_szEndTime",64));r.push(new Array(0,"m_iElectNumber",4));r.push(new Array(0,"m_iGroupNumber",4));r.push(new Array(0,"m_szApplySuccess",64));r.push(new Array(0,"m_szTitle",64));r.push(new Array(0,"m_szTitle1",64));r.push(new Array(0,"m_szContent1",200));r.push(new Array(0,"m_szTitle2",64));r.push(new Array(0,"m_szContent2",200));r.push(new Array(0,"m_szTitle3",64));r.push(new Array(0,"m_szContent3",1024));r.push(new Array(0,"m_szContentPage201",200));r.push(new Array(0,"m_szContentPage202",200));r.push(new Array(0,"m_szContentPage203",200));r.push(new Array(0,"m_szContentPage204",200));r.push(new Array(0,"m_szContentPage205",200));r.push(new Array(0,"m_szTimeDesc",200));r.push(new Array(0,"m_szPostTitle",64));r.push(new Array(0,"m_szPostDesc1",200));r.push(new Array(0,"m_szPostDesc2",200));r.push(new Array(0,"m_szPostDesc3",200));r.push(new Array(0,"m_szPostDesc4",200));r.push(new Array(0,"m_szStageName",200));return new Array("MatchConfig_Client_Tab","MatchConfig_Client",r);break;case"mrock_match_division_client":r.push(new Array(0,"m_iMatchID",4));r.push(new Array(0,"m_szFilterSort1",64));r.push(new Array(0,"m_szFilterSort2",64));r.push(new Array(0,"m_szFilter1",64));r.push(new Array(0,"m_szFilter2",64));return new Array("MatchDivisionConfig_Client_Tab","MatchDivisionConfig_Client",r);break;case"mrock_medal_client":break;case"mrock_noble_client":break;case"mrock_noble_gift_client":break;case"mrock_papasong_client":r.push(new Array(0,"m_ushSongID",2));r.push(new Array(0,"m_iVersion",4));r.push(new Array(0,"m_szSongName",64));r.push(new Array(0,"m_cDifficulty",1));r.push(new Array(0,"m_cLevel",1));r.push(new Array(0,"m_szPath",64));r.push(new Array(0,"m_szArtist",64));r.push(new Array(0,"m_szSongTime",64));r.push(new Array(0,"m_iGameTime",4));r.push(new Array(0,"m_szRegion",20));r.push(new Array(0,"m_szStyle",20));r.push(new Array(0,"m_szBPM",20));r.push(new Array(0,"m_szNoteNumber",20));r.push(new Array(0,"m_iOrderIndex",4));r.push(new Array(0,"m_ucIsOpen",1));r.push(new Array(0,"m_ucIsFree",1));r.push(new Array(0,"m_ucIsHide",1));r.push(new Array(0,"m_ucIsReward",1));r.push(new Array(0,"m_ucIsLevelReward",1));r.push(new Array(0,"m_iSongType",4));return new Array("PapaSongConfig_Client_Tab","PapaSongConfig_Client",r);break;case"mrock_questconfig_client":r.push(new Array(0,"m_iQuestId",4));r.push(new Array(0,"m_szQuestName",300));r.push(new Array(0,"m_szDescription",300));r.push(new Array(0,"m_iMethod",4));r.push(new Array(0,"m_iNodeType",4));r.push(new Array(0,"m_iNodeValue",4));r.push(new Array(0,"m_iNodeLimit",4));r.push(new Array(0,"m_iSongNodeID",4));r.push(new Array(0,"m_iSongNodeNoteType",4));r.push(new Array(0,"m_iRewardType",4));r.push(new Array(0,"m_iRewardID",4));r.push(new Array(0,"m_iRewardValue",4));return new Array("QuestConfig_Client_Tab","QuestConfig_Client",r);break;case"mrock_recharge_ios_client":case"mrock_recharge_android_client":break;case"mrock_room_client":r.push(new Array(0,"m_ushRoomID",2));r.push(new Array(0,"m_ucSongType",1));r.push(new Array(0,"m_ucTicketType",1));r.push(new Array(0,"m_iTicketNum",4));r.push(new Array(0,"m_ucRewardType",1));r.push(new Array(0,"m_iRewardNum",4));r.push(new Array(0,"m_iRewardIntergral",4));r.push(new Array(0,"m_ucIsOpen",1));r.push(new Array(0,"m_ucIsNewOpen",1));r.push(new Array(0,"m_ucIsProp",1));r.push(new Array(0,"m_iMinClientVersion",4));return new Array("RoomConfig_Client_Tab","RoomConfig_Client",r);break;case"mrock_share_client":break;case"mrock_song_client":case"mrock_song_client_android":case"mrock_songlevel_client":r.push(new Array(0,"m_ushSongID",2));r.push(new Array(0,"m_iVersion",4));r.push(new Array(0,"m_szSongName",64));r.push(new Array(0,"m_szPath",64));r.push(new Array(0,"m_szArtist",64));r.push(new Array(0,"m_szComposer",64));r.push(new Array(0,"m_szSongTime",64));r.push(new Array(0,"m_iGameTime",4));r.push(new Array(0,"m_iRegion",4));r.push(new Array(0,"m_iStyle",4));r.push(new Array(0,"m_ucIsNew",2));r.push(new Array(0,"m_ucIsHot",2));r.push(new Array(0,"m_ucIsRecommend",2));r.push(new Array(0,"m_szBPM",64));r.push(new Array(0,"m_ucIsOpen",2));r.push(new Array(0,"m_ucCanBuy",1));r.push(new Array(0,"m_iOrderIndex",4));r.push(new Array(0,"m_bIsFree",1));r.push(new Array(0,"m_bSongPkg",1));r.push(new Array(0,"m_szFreeBeginTime",64));r.push(new Array(0,"m_szFreeEndTime",64));r.push(new Array(0,"m_ush4KeyEasy",2));r.push(new Array(0,"m_ush4KeyNormal",2));r.push(new Array(0,"m_ush4KeyHard",2));r.push(new Array(0,"m_ush5KeyEasy",2));r.push(new Array(0,"m_ush5KeyNormal",2));r.push(new Array(0,"m_ush5KeyHard",2));r.push(new Array(0,"m_ush6KeyEasy",2));r.push(new Array(0,"m_ush6KeyNormal",2));r.push(new Array(0,"m_ush6KeyHard",2));r.push(new Array(0,"m_iPrice",4));r.push(new Array(0,"m_szNoteNumber",128));r.push(new Array(0,"m_szProductID",128));r.push(new Array(0,"m_iVipFlag",4));r.push(new Array(0,"m_bIsHide",1));r.push(new Array(0,"m_bIsReward",1));r.push(new Array(0,"m_bIsLevelReward",1));return new Array("SongConfig_Client_Tab","SongConfig_Client",r);break;case"mrock_SongPkg_client":r.push(new Array(0,"m_ushIndex",2));r.push(new Array(0,"m_szProductID",128));r.push(new Array(0,"m_szDesc",512));r.push(new Array(0,"m_szPath",128));r.push(new Array(0,"m_iAndroidPrice",4));r.push(new Array(0,"m_iPrice",4));r.push(new Array(0,"m_iEnable",4));r.push(new Array(0,"m_bIsNew",1));r.push(new Array(0,"m_bIsHot",1));r.push(new Array(0,"m_iNum",4));r.push(new Array(1,"m_astSongs,PkgSong",10));return new Array("SongPkgConfig_Client_Tab","SongPkgConfig_Client",r);break;case"mrock_starmall_exchange_client":break;case"mrock_SysParam_client":r.push(new Array(0,"m_iParamID",4));r.push(new Array(0,"m_iParamValue",4));return new Array("SysParamConfig_Client_Tab","SysParamConfig_Client",r);break;case"mrock_txt_client":r.push(new Array(0,"m_uiID",4));r.push(new Array(0,"m_szDescriptionZH",256));return new Array("TxtConfig_Client_Tab","TxtConfig_Client",r);break;}
return[];}
function GetFontSize(f){var r=0;var a=f.split(" ");for(var i=0;i<a.length;i++){if((a[i].length>2)&&(a[i].substring(a[i].length-2,a[i].length)=="px")){var s;try{s=parseInt(a[i].substring(0,a[i].length-2),10);if(isNaN(s)){s=0;}}
catch(e){s=0;}
if(s!=0){r=s;break;}}}
return r;}
function SetFontSize(f,n){var a=f.split(" ");for(var i=0;i<a.length;i++){if((a[i].length>2)&&(a[i].substring(a[i].length-2,a[i].length)=="px")){a[i]=n.toString()+"px";break;}}
return a.join(" ");}
function GetDateTime(){var d=new Date();return d.getFullYear().toString().fill("0",4,true)+"."+(d.getMonth()+1).toString().fill("0",2,true)+"."+d.getDate().toString().fill("0",2,true)+" "+d.getHours().toString().fill("0",2,true)+":"+d.getMinutes().toString().fill("0",2,true)+":"+d.getSeconds().toString().fill("0",2,true);}
function GetImgSrc(b){if(b.length==0){return"";}
var t;switch(b[0]){case 0x42:t="bmp";break;case 0xFF:t="jpg";break;case 0x47:t="gif";break;case 0x89:t="png";break;}
return"data:image/"+t+";base64,"+BytesToBase64(b);}
function GetImgSize(b){if(b.length==0){return"0×0";}
var img=document.createElement("img");img.style.display="none";img.src=GetImgSrc(b);return img.width.toString()+"×"+img.height.toString();}
function GetMD5(t){var SetArray=function(t){var c;var p;var l=t.length;var n=(((l+8)-((l+8)%64))/64+1)*16;var r=new Int32Array(n-1);var i=0;while(i<l){c=(i-(i%4))/4;p=(i%4)*8;r[c]=(r[c]|(t[i]<<p));i++;}
c=(i-(i%4))/4;p=(i%4)*8;r[c]=r[c]|(0x80<<p);r[n-2]=l<<3;r[n-1]=l>>>29;return r;};var Add=function(X,Y){var r=(X&0x3FFFFFFF)+(Y&0x3FFFFFFF);var X4=(X&0x40000000);var Y4=(Y&0x40000000);var X8=(X&0x80000000);var Y8=(Y&0x80000000);if(X4&Y4){return(r^0x80000000^X8^Y8);}
if(X4|Y4){if(r&0x40000000){return(r^0xC0000000^X8^Y8);}else{return(r^0x40000000^X8^Y8);}}else{return(r^X8^Y8);}};var Rotate=function(t,b){return(t<<b)|(t>>>(32-b));};var F=function(X,Y,Z){return(X&Y)|((~X)&Z);};var G=function(X,Y,Z){return(X&Z)|(Y&(~Z));};var H=function(X,Y,Z){return(X^Y^Z);};var I=function(X,Y,Z){return(Y^(X|(~Z)));};var FF=function(a,b,c,d,m,s,t){a=Add(a,Add(Add(F(b,c,d),m),t));return Add(Rotate(a,s),b);};var GG=function(a,b,c,d,m,s,t){a=Add(a,Add(Add(G(b,c,d),m),t));return Add(Rotate(a,s),b);};var HH=function(a,b,c,d,m,s,t){a=Add(a,Add(Add(H(b,c,d),m),t));return Add(Rotate(a,s),b);};var II=function(a,b,c,d,m,s,t){a=Add(a,Add(Add(I(b,c,d),m),t));return Add(Rotate(a,s),b);};var m=SetArray(t);var A;var B;var C;var D;var a=0x67452301;var b=0xEFCDAB89;var c=0x98BADCFE;var d=0x10325476;for(var i=0;i<m.length;i+=16){A=a;B=b;C=c;D=d;a=FF(a,b,c,d,m[i+0],7,0xD76AA478);d=FF(d,a,b,c,m[i+1],12,0xE8C7B756);c=FF(c,d,a,b,m[i+2],17,0x242070DB);b=FF(b,c,d,a,m[i+3],22,0xC1BDCEEE);a=FF(a,b,c,d,m[i+4],7,0xF57C0FAF);d=FF(d,a,b,c,m[i+5],12,0x4787C62A);c=FF(c,d,a,b,m[i+6],17,0xA8304613);b=FF(b,c,d,a,m[i+7],22,0xFD469501);a=FF(a,b,c,d,m[i+8],7,0x698098D8);d=FF(d,a,b,c,m[i+9],12,0x8B44F7AF);c=FF(c,d,a,b,m[i+10],17,0xFFFF5BB1);b=FF(b,c,d,a,m[i+11],22,0x895CD7BE);a=FF(a,b,c,d,m[i+12],7,0x6B901122);d=FF(d,a,b,c,m[i+13],12,0xFD987193);c=FF(c,d,a,b,m[i+14],17,0xA679438E);b=FF(b,c,d,a,m[i+15],22,0x49B40821);a=GG(a,b,c,d,m[i+1],5,0xF61E2562);d=GG(d,a,b,c,m[i+6],9,0xC040B340);c=GG(c,d,a,b,m[i+11],14,0x265E5A51);b=GG(b,c,d,a,m[i+0],20,0xE9B6C7AA);a=GG(a,b,c,d,m[i+5],5,0xD62F105D);d=GG(d,a,b,c,m[i+10],9,0x2441453);c=GG(c,d,a,b,m[i+15],14,0xD8A1E681);b=GG(b,c,d,a,m[i+4],20,0xE7D3FBC8);a=GG(a,b,c,d,m[i+9],5,0x21E1CDE6);d=GG(d,a,b,c,m[i+14],9,0xC33707D6);c=GG(c,d,a,b,m[i+3],14,0xF4D50D87);b=GG(b,c,d,a,m[i+8],20,0x455A14ED);a=GG(a,b,c,d,m[i+13],5,0xA9E3E905);d=GG(d,a,b,c,m[i+2],9,0xFCEFA3F8);c=GG(c,d,a,b,m[i+7],14,0x676F02D9);b=GG(b,c,d,a,m[i+12],20,0x8D2A4C8A);a=HH(a,b,c,d,m[i+5],4,0xFFFA3942);d=HH(d,a,b,c,m[i+8],11,0x8771F681);c=HH(c,d,a,b,m[i+11],16,0x6D9D6122);b=HH(b,c,d,a,m[i+14],23,0xFDE5380C);a=HH(a,b,c,d,m[i+1],4,0xA4BEEA44);d=HH(d,a,b,c,m[i+4],11,0x4BDECFA9);c=HH(c,d,a,b,m[i+7],16,0xF6BB4B60);b=HH(b,c,d,a,m[i+10],23,0xBEBFBC70);a=HH(a,b,c,d,m[i+13],4,0x289B7EC6);d=HH(d,a,b,c,m[i+0],11,0xEAA127FA);c=HH(c,d,a,b,m[i+3],16,0xD4EF3085);b=HH(b,c,d,a,m[i+6],23,0x4881D05);a=HH(a,b,c,d,m[i+9],4,0xD9D4D039);d=HH(d,a,b,c,m[i+12],11,0xE6DB99E5);c=HH(c,d,a,b,m[i+15],16,0x1FA27CF8);b=HH(b,c,d,a,m[i+2],23,0xC4AC5665);a=II(a,b,c,d,m[i+0],6,0xF4292244);d=II(d,a,b,c,m[i+7],10,0x432AFF97);c=II(c,d,a,b,m[i+14],15,0xAB9423A7);b=II(b,c,d,a,m[i+5],21,0xFC93A039);a=II(a,b,c,d,m[i+12],6,0x655B59C3);d=II(d,a,b,c,m[i+3],10,0x8F0CCC92);c=II(c,d,a,b,m[i+10],15,0xFFEFF47D);b=II(b,c,d,a,m[i+1],21,0x85845DD1);a=II(a,b,c,d,m[i+8],6,0x6FA87E4F);d=II(d,a,b,c,m[i+15],10,0xFE2CE6E0);c=II(c,d,a,b,m[i+6],15,0xA3014314);b=II(b,c,d,a,m[i+13],21,0x4E0811A1);a=II(a,b,c,d,m[i+4],6,0xF7537E82);d=II(d,a,b,c,m[i+11],10,0xBD3AF235);c=II(c,d,a,b,m[i+2],15,0x2AD7D2BB);b=II(b,c,d,a,m[i+9],21,0xEB86D391);a=Add(a,A);b=Add(b,B);c=Add(c,C);d=Add(d,D);}
return(BytesToHex(Int32ToBytes(a),"")+BytesToHex(Int32ToBytes(b),"")+BytesToHex(Int32ToBytes(c),"")+BytesToHex(Int32ToBytes(d),"")).toLowerCase();}
function GetCRC32(t){var s=(arguments.length>1)?arguments[1]:0;var l=(arguments.length>2)?arguments[2]:t.length-s;var Table=(function(){var r=new Int32Array(256);var c;for(var i=0;i<256;i++){c=i;for(var j=0;j<8;j++){if(c&1){c=(c&0xFFFFFFFE)/2&0x7FFFFFFF^0xEDB88320;}
else{c=(c&0xFFFFFFFE)/2&0x7FFFFFFF;}}
r[i]=c;}
return r;})();var c=~0;for(var i=0;i<l;i++){c=(c>>>8)^Table[c&0xFF^t[i+s]];}
return BytesToHex(Int32ToBytes(~c>>>0,false));}
function MillisecondToTime(t){var ms=t;var m=Math.floor(ms/60000);ms-=m*60000;var s=Math.floor(ms/1000);ms-=s*1000;return m.toString()+":"+s.toString().fill("0",2,true)+"."+ms.toString();}
function ComboToScore(n){var r=0;if(n>=100){r+=(n-100)*600;n=100;}
if(n>=50){r+=(n-50)*466;n=50;}
if(n>=20){r+=(n-20)*332;n=20;}
r+=n*200;return r;}</script><script type="text/javascript">String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"");};String.prototype.fill=function(c,l,b){if((c.length=0)||(l<=this.length)){return this;}
if(c.length>1){c=c.substring(0,1);}
var r=[];for(var i=0;i<l-this.length;i++){r.push(c);}
if(b){return r.join("")+this;}
else{return this+r.join("");}};String.prototype.insert=function(s,n){var r=[];for(var i=0;i*2<this.length;i++){r.push(this.substr(i*2,n));}
return r.join(s);}
Array.prototype.add=function(a){if(typeof a.length==="undefined"){a=[a];}
for(var i=0;i<a.length;i++){this[this.length]=a[i];}};Array.prototype.replace=function(r,s){for(var i=0;i<r.length;i++){if(s+i>this.length-1){break;}
this[s+i]=r[i];}};function DuplicateString(t,n){var r=[];for(var i=0;i<n;i++){r[i]=t;}
return r.join("");}
function LTrimString(t,c){var n=0;for(var i=0;i<t.length;i++){if(t[i]==c){n+=1;}
else{break;}}
return t.substring(n,t.length+1);}
function DuplicateBytes(t,n){var r=new Uint8Array(n);for(var i=0;i<r.length;i++){r[i]=t;}
return r;}
function RTrimBytes(t,c){var n=t.length-1;for(var i=0;i<t.length;i++){if(t[t.length-i-1]==c){n-=1;}
else{break;}}
return SliceBytes(t,0,n+1);}
function FillBytes(t,c,l,b){if(c<0){c=0;}
if(c>255){c=255;}
if(l<0){l=0;}
if(l>t.length){l=t.length;}
var a=new Uint8Array(t.length-l);for(var i=0;i<a.length;i++){a[i]=c;}
var r=new Uint8Array(t.length+a.length);if(b){r.set(a,0);r.set(b,a.length);}
else{r.set(b,0);r.set(a,b.length);}
return r;}
function SliceBytes(t,s,e){return new Uint8Array(new Uint8Array(t).buffer.slice(s,e));}
function BytesToArray(t){var r=[];for(var i=0;i<t.length;i++){r[i]=t[i];}
return r;}
function UnrepeatArray(t){var r=[];var h=[];for(var i=0,e;(e=t[i])!=null;i++){if(!h[e]){r.push(e);h[e]=true;}}
return r;}
function MajorityArray(t){if((typeof(t)=="undefined")||(t.length==0)){return"";}
if(t.length==1){return t[0];}
var u=UnrepeatArray(t);if(u.length==1){return u[0];}
var c=[];for(var i=0;i<u.length;i++){c[i]=0;for(var j=0;j<t.length;j++){if(t[j]==u[i]){c[i]+=1;}}}
var m=c[0];var n=0;for(var i=1;i<c.length;i++){if(c[i]>m){m=c[i];n=i;}}
return u[n];}
function CloseNumber(t,c,v){var r=t;if(Math.abs(t-c)<=v){r=c;}
return r;}
function SortNumber(a,b){return(a-b)}</script><script type="text/javascript">function BytesToBase64(t){var r=[];var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var c1;var c2;var c3;var i=0;while(i<t.length){c1=t[i++]&0xFF;if(i==t.length){r.push(c.charAt(c1>>2));r.push(c.charAt((c1&0x3)<<4));r.push("==");break;}
c2=t[i++];if(i==t.length){r.push(c.charAt(c1>>2));r.push(c.charAt(((c1&0x3)<<4)|((c2&0xF0)>>4)));r.push(c.charAt((c2&0xF)<<2));r.push("=");break;}
c3=t[i++];r.push(c.charAt(c1>>2));r.push(c.charAt(((c1&0x3)<<4)|((c2&0xF0)>>4)));r.push(c.charAt(((c2&0xF)<<2)|((c3&0xC0)>>6)));r.push(c.charAt(c3&0x3F));}
return r.join("");}
function Base64ToBytes(t){var r=new Uint8Array(t.length/4*3);var c=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);var c1;var c2;var c3;var c4;var i=0;var j=0;while(i<t.length){do{c1=c[t.charCodeAt(i++)&0xFF];}
while(i<t.length&&c1==-1);if(c1==-1)
break;do{c2=c[t.charCodeAt(i++)&0xFF];}
while(i<t.length&&c2==-1);if(c2==-1)
break;r[j++]=((c1<<2)|((c2&0x30)>>4));do{c3=t.charCodeAt(i++)&0xFF;if(c3==61)
return r;c3=c[c3];}
while(i<t.length&&c3==-1);if(c3==-1)
break;r[j++]=(((c2&0xF)<<4)|((c3&0x3C)>>2));do{c4=t.charCodeAt(i++)&0xFF;if(c4==61)
return r;c4=c[c4];}
while(i<t.length&&c4==-1);if(c4==-1)
break;r[j++]=(((c3&0x03)<<6)|c4);}
return r;}
function BytesToText(t){var r=BytesToHex(t,"");if(r!=""){r=decodeURIComponent("%"+r.insert("%",2));}
return r;}
function TextToBytes(t){t=encodeURIComponent(t);var r=[];for(var i=0;i<t.length;i++){if(t.substr(i,1)!="%"){r.push(HexToBytes(t.substr(i,1).charCodeAt().toString(16))[0]);}
else{r.push(HexToBytes(t.substr(i+1,2))[0]);i+=2;}}
return new Uint8Array(r);}
function BytesToHex(t,c){if(t.length==0){return"";}
var r=[];for(var i=0;i<t.length;i++){r.push(t[i].toString(16).toUpperCase().fill("0",2,true));}
return r.join(c);}
function HexToBytes(t){if(t==""){return new Uint8Array(0);}
if(t.length%2!=0){t+="0";}
var r=new Uint8Array(t.length/2);for(var i=0;i<r.length;i++){var b;try{b=parseInt(t.substring(i*2,i*2+2),16);}
catch(e){b=0;}
r[i]=b;}
return r;}
function BytesToInt16(t){if(t.length>2){t=SliceBytes(t,0,2);}
var a=new Uint8Array(2);a.set(t);return new DataView(a.buffer).getInt16(0,LittleEndian);}
function Int16ToBytes(t){var e=(arguments.length>1)?arguments[1]:LittleEndian;var d=new DataView(new ArrayBuffer(2));d.setInt16(0,t,e);return new Uint8Array(d.buffer);}
function BytesToInt32(t){if(t.length>4){t=SliceBytes(t,0,4);}
var a=new Uint8Array(4);a.set(t);return new DataView(a.buffer).getInt32(0,LittleEndian);}
function Int32ToBytes(t){var e=(arguments.length>1)?arguments[1]:LittleEndian;var d=new DataView(new ArrayBuffer(4));d.setInt32(0,t,e);return new Uint8Array(d.buffer);}
function BytesToFloat64(t){if(t.length>8){t=SliceBytes(t,0,8);}
var a=new Uint8Array(8);a.set(t);return new DataView(a.buffer).getFloat64(0,LittleEndian);}
function TextToHtml(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/"/g,"&quot;");}
function HtmlToText(t){return t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&quot;/g,'"');}
function Utf8ToUtf16(t){var r=[];var c1;var c2;var c3;var i=0;while(i<t.length){c1=t.charCodeAt(i++);switch(c1>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r.push(t.charAt(i-1));break;case 12:case 13:c2=t.charCodeAt(i++);r.push(String.fromCharCode(((c1&0x1F)<<6)|(c2&0x3F)));break;case 14:c2=t.charCodeAt(i++);c3=t.charCodeAt(i++);r.push(String.fromCharCode(((c1&0x0F)<<12)|((c2&0x3F)<<6)|((c3&0x3F)<<0)));break;}}
return r.join("");}
function Utf16ToUtf8(t){var r=[];var c;for(var i=0;i<t.length;i++){c=t.charCodeAt(i);if((c>=0x0001)&&(c<=0x007F)){r.push(t.charAt(i));}
else if(c>0x07FF){r.push(String.fromCharCode(0xE0|((c>>12)&0x0F)));r.push(String.fromCharCode(0x80|((c>>6)&0x3F)));r.push(String.fromCharCode(0x80|((c>>0)&0x3F)));}
else{r.push(String.fromCharCode(0xC0|((c>>6)&0x1F)));r.push(String.fromCharCode(0x80|((c>>0)&0x3F)));}}
return r.join("");}</script><script type="text/javascript">function TxtToTxt(b){if(b.length==0){return"";}
return BytesToText(b);}
function BinToXmlbin(b){if(b.length==0){return"";}
var ReadByte=function(){var r=LTrimString(BytesToHex(SliceBytes(b,p,p+1),"").toLowerCase(),"0");if(r==""){r="0";}
p+=1;return"0x"+r+" ";};var ReadInt16=function(){var r=BytesToInt16(SliceBytes(b,p,p+2));p+=2;return r.toString()+" ";};var ReadInt32=function(){var r=BytesToInt32(SliceBytes(b,p,p+4));p+=4;return r.toString()+" ";};var ReadDateTime=function(){var y=BytesToInt32(SliceBytes(b,p,p+4));p+=4;var M=BytesToInt16(SliceBytes(b,p,p+2));p+=2;var d=BytesToInt16(SliceBytes(b,p,p+2));p+=2;var H=BytesToInt16(SliceBytes(b,p,p+2));p+=2;var m=BytesToInt16(SliceBytes(b,p,p+2));p+=2;var s=BytesToInt16(SliceBytes(b,p,p+2));p+=2;return y.toString().fill(" ",4,true).replace(/ /g,"&nbsp;")+"-"+M.toString().fill("0",2,true)+"-"+d.toString().fill("0",2,true)+" "+H.toString().fill("0",2,true)+":"+m.toString().fill("0",2,true)+":"+s.toString().fill("0",2,true);};var ReadText=function(n){var r=BytesToText(RTrimBytes(SliceBytes(b,p,p+n),0));p+=n;return r;};var ReadData=function(n){switch(n){case 1:return ReadByte();break;case 2:return ReadInt16();break;case 4:return ReadInt32();break;case 14:return ReadDateTime();break;case 20:case 22:case 32:case 48:case 64:case 128:case 200:case 256:case 300:case 512:case 1024:return ReadText(n);break;default:p+=n;return"";}};var WriteData=function(l,f,c){xml.push(DuplicateString("&nbsp;",4*l)+"&lt;"+f+"&gt;"+c+"&lt;/"+f+"&gt;");};var WriteDataA=function(l,f,n){WriteData(l,f,ReadData(n));};var WriteDataE=function(l,f,t,n){for(var i=0;i<n;i++){switch(f){case"TResHeadAll":xml.push(DuplicateString("&nbsp;",4*l)+"&lt;"+f+"&nbsp;version=&quot;5&quot;&gt;");xml.push(DuplicateString("&nbsp;",4*(l+1))+"&lt;resHead type=&quot;TResHead&quot;&gt;");xml.push(DuplicateString("&nbsp;",4*(l+2))+"&lt;Magic&gt;1397052237 &lt;/Magic&gt;");WriteDataA(l+2,"Version",4);WriteDataA(l+2,"Unit",4);WriteDataA(l+2,"Count",4);WriteDataA(l+2,"MetalibHash",32);WriteDataA(l+2,"ResVersion",2);WriteDataA(l+2,"CreateTime",14);WriteDataA(l+2,"ResEncording",32);WriteDataA(l+2,"ContentHash",32);p+=4;xml.push(DuplicateString("&nbsp;",4*(l+1))+"&lt;/resHead&gt;");xml.push(DuplicateString("&nbsp;",4*(l+1))+"&lt;resHeadExt&nbsp;type=&quot;TResHeadExt&quot;&gt;");WriteDataA(l+2,"DataOffset",4);xml.push(DuplicateString("&nbsp;",4*(l+1))+"&lt;/resHeadExt&gt;");xml.push(DuplicateString("&nbsp;",4*l)+"&lt;/"+f+"&gt;");break;case"m_astReward":switch(t){case"ActiveReward":var c1=ReadData(1);var c2=ReadData(4);var c3=ReadData(4);if(!((c1=="0x0 ")&&(c2=="0 ")&&(c3=="0 "))){xml.push(DuplicateString("&nbsp;",4*l)+"&lt;"+f+" type=&quot;"+t+"&quot;&gt;");WriteData(l+1,"m_ucRewardType",c1);WriteData(l+1,"m_iRewardID",c2);WriteData(l+1,"m_iRewardValue",c3);xml.push(DuplicateString("&nbsp;",4*l)+"&lt;/"+f+"&gt;");}
break;case"MarketActReward":var c1=ReadData(1);var c2=ReadData(2);var c3=ReadData(4);if(!((c1=="0x0 ")&&(c2=="0 ")&&(c3=="0 "))){xml.push(DuplicateString("&nbsp;",4*l)+"&lt;"+f+" type=&quot;"+t+"&quot;&gt;");WriteData(l+1,"m_ucRewardType",c1);WriteData(l+1,"m_ushRewardID",c2);WriteData(l+1,"m_iRewardValue",c3);xml.push(DuplicateString("&nbsp;",4*l)+"&lt;/"+f+"&gt;");}
break;}
break;case"m_astSongs":var c=ReadData(2);if(!(c=="0 ")){xml.push(DuplicateString("&nbsp;",4*l)+"&lt;"+f+" type=&quot;"+t+"&quot;&gt;");WriteData(l+1,"ID",c);xml.push(DuplicateString("&nbsp;",4*l)+"&lt;/"+f+"&gt;");}
break;}}};var WriteDataT=function(s){if(s.length==0){return;}
p=4;xml.push("&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot; ?&gt;");xml.push("&lt;"+s[0]+"&gt;");WriteDataE(0,"TResHeadAll","",1);while(p<b.length){xml.push("&lt;"+s[1]+" version=&quot;1&quot;&gt;");for(var i=0;i<s[2].length;i++){switch(s[2][i][0]){case 0:WriteDataA(1,s[2][i][1],s[2][i][2]);break;case 1:var a=s[2][i][1].split(",");WriteDataE(1,a[0],a[1],s[2][i][2]);break;}}
xml.push("&lt;/"+s[1]+"&gt;");}
xml.push("&lt;/"+s[0]+"&gt;");};var xml=[];var p=0;WriteDataT(GetBinStructure());return HtmlToText(xml.join("\r\n"));}
function BinToHtml(b){return XmlbinToHtml(TextToBytes(BinToXmlbin(b)));}
function XmlbinToBin(b){if(b.length==0){return"";}
b=BytesToText(b).replace(/\r\n/g,"");var ReadData=function(f1,f2){var r;var s1=b.indexOf(f1,p);if(s1==-1){p=b.length;return"";}
else{s1+=f1.length;}
var s2=b.indexOf(f2,s1);if(s2==-1){p=b.length;return"";}
p=s2+f2.length;return b.substring(s1,s2);};var WriteByte=function(c){if(c==""){c="0x0 "}
if((c.indexOf("0x")==0)&&(c.lastIndexOf(" ")==(c.length-1))){bin.add(parseInt(c,16));}};var WriteInt16=function(c){if(c==""){c="0 "}
if(c.lastIndexOf(" ")==(c.length-1)){bin.add(BytesToArray(Int16ToBytes(parseInt(c,10))));}};var WriteInt32=function(c){if(c==""){c="0 "}
if(c.lastIndexOf(" ")==(c.length-1)){bin.add(BytesToArray(Int32ToBytes(parseInt(c,10))));}};var WriteDateTime=function(c){if(c==""){c="   0-00-00 00:00:00"}
var a=c.split("-");var y=a[0];WriteInt32(y.toString()+" ");var M=a[1];WriteInt16(M.toString()+" ");a=a[2].split(" ");var d=a[0];WriteInt16(d.toString()+" ");a=a[1].split(":");var H=a[0];WriteInt16(H.toString()+" ");var m=a[1];WriteInt16(m.toString()+" ");var s=a[2];WriteInt16(s.toString()+" ");};var WriteText=function(c,n){var r=BytesToArray(TextToBytes(c));bin.add(r);bin.add(BytesToArray(DuplicateBytes(0,n-r.length)));};var WriteData=function(c,n){switch(n){case 1:WriteByte(c);break;case 2:WriteInt16(c);break;case 4:WriteInt32(c);break;case 14:WriteDateTime(c);break;case 20:case 22:case 32:case 48:case 64:case 128:case 200:case 256:case 300:case 512:case 1024:WriteText(c,n);break;}};var WriteDataE=function(f,t,n){var l=[];for(var i=0;i<n;i++){if(f=="TResHeadAll"){l.push(b);}
else{l.push(ReadData("<"+f+" type="+'"'+t+'"'+">","</"+f+">"));}}
for(var i=0;i<l.length;i++){b=l[i];p=0;switch(f){case"TResHeadAll":WriteData(ReadData("<Version>","</Version>"),4);WriteData(ReadData("<Unit>","</Unit>"),4);WriteData(ReadData("<Count>","</Count>"),4);WriteData(ReadData("<MetalibHash>","</MetalibHash>"),32);WriteData(ReadData("<ResVersion>","</ResVersion>"),2);WriteData(ReadData("<CreateTime>","</CreateTime>"),14);WriteData(ReadData("<ResEncording>","</ResEncording>"),32);WriteData(ReadData("<ContentHash>","</ContentHash>"),32);WriteData("",4);WriteData(ReadData("<DataOffset>","</DataOffset>"),4);break;case"m_astReward":switch(t){case"ActiveReward":if(b!=""){WriteData(ReadData("<m_ucRewardType>","</m_ucRewardType>"),1);WriteData(ReadData("<m_iRewardID>","</m_iRewardID>"),4);WriteData(ReadData("<m_iRewardValue>","</m_iRewardValue>"),4);}
else{WriteData("",1);WriteData("",4);WriteData("",4);}
break;case"MarketActReward":if(b!=""){WriteData(ReadData("<m_ucRewardType>","</m_ucRewardType>"),1);WriteData(ReadData("<m_ushRewardID>","</m_ushRewardID>"),2);WriteData(ReadData("<m_iRewardValue>","</m_iRewardValue>"),4);}
else{WriteData("",1);WriteData("",2);WriteData("",4);}
break;}
break;case"m_astSongs":if(b!=""){WriteData(ReadData("<ID>","</ID>"),2);}
else{WriteData("",2);}
break;}}};var WriteDataT=function(s){if(s.length==0){return;}
b=ReadData("<"+s[0]+">","</"+s[0]+">");p=0;bin=BytesToArray(TextToBytes("MSES"));WriteDataE("TResHeadAll","",1);var l=[];while(p<b.length){l.push(ReadData("<"+s[1]+" version="+'"'+"1"+'"'+">","</"+s[1]+">"))}
for(var i=0;i<l.length;i++){b=l[i];p=0;for(var j=0;j<s[2].length;j++){switch(s[2][j][0]){case 0:WriteData(ReadData("<"+s[2][j][1]+">","</"+s[2][j][1]+">"),s[2][j][2]);break;case 1:var a=s[2][j][1].split(",");WriteDataE(a[0],a[1],s[2][j][2]);break;}}}
bin.replace(BytesToArray(Int32ToBytes(l.length)),12);bin.replace(TextToBytes(GetMD5(bin.slice(136,bin.length))),96);};var bin=[];var p=0;WriteDataT(GetBinStructure());return new Uint8Array(bin);}
function XmlbinToHtml(b){if(b.length==0){return"";}
b=BytesToText(b).replace(/\r\n/g,"");var ReadData=function(f1,f2){var r;var s1=b.indexOf(f1,p);if(s1==-1){p=b.length;return"";}
else{s1+=f1.length;}
var s2=b.indexOf(f2,s1);if(s2==-1){p=b.length;return"";}
p=s2+f2.length;return b.substring(s1,s2);};var WriteDataT=function(s){if(s.length==0){return;}
html.push("<html><meta charset ="+'"UTF-8"'+"/><head><title>"+FileName+"</title></head><body><table border="+'"1"'+"><caption>"+FileName+"</caption>");var e=false;for(var i=0;i<s[2].length;i++){if(s[2][i][0]==1){e=true;break;}}
html.push("<tr>");for(var i=0;i<s[2].length;i++){switch(s[2][i][0]){case 0:html.push((e?"<th rowspan="+'"2"'+">":"<th>")+s[2][i][1]+"</th>");break;case 1:var a=s[2][i][1].split(",");switch(a[0]){case"m_astReward":switch(a[1]){case"ActiveReward":html.push(DuplicateString((e?"<th colspan="+'"3"'+">":"<th>")+a[0]+"</th>",s[2][i][2]));break;case"MarketActReward":html.push(DuplicateString((e?"<th colspan="+'"3"'+">":"<th>")+a[0]+"</th>",s[2][i][2]));break;}
break;case"m_astSongs":html.push(DuplicateString((e?"<th colspan="+'"1"'+">":"<th>")+a[0]+"</th>",s[2][i][2]));break;}
break;}}
html.push("</tr>");html.push("<tr>");for(var i=0;i<s[2].length;i++){switch(s[2][i][0]){case 1:var a=s[2][i][1].split(",");switch(a[0]){case"m_astReward":switch(a[1]){case"ActiveReward":html.push(DuplicateString("<th>m_ucRewardType</th><th>m_iRewardID</th><th>m_iRewardValue</th>",s[2][i][2]));break;case"MarketActReward":html.push(DuplicateString("<th>m_ucRewardType</th><th>m_ushRewardID</th><th>m_iRewardValue</th>",s[2][i][2]));break;}
break;case"m_astSongs":html.push(DuplicateString("<th>ID</th>",s[2][i][2]));break;}
break;}}
html.push("</tr>");b=ReadData("<"+s[0]+">","</"+s[0]+">");p=0;var l=[];while(p<b.length){l.push(ReadData("<"+s[1]+" version="+'"'+"1"+'"'+">","</"+s[1]+">"))}
for(var i=0;i<l.length;i++){b=l[i];p=0;html.push("<tr>");for(var j=0;j<s[2].length;j++){switch(s[2][j][0]){case 0:html.push("<td>"+ReadData("<"+s[2][j][1]+">","</"+s[2][j][1]+">")+"</td>");break;case 1:var e=[];for(var k=0;k<s[2][j][2];k++){e.push(ReadData("<"+a[0]+" type="+'"'+a[1]+'"'+">","</"+a[0]+">"));}
for(var k=0;k<s[2][j][2];k++){b=e[k];p=0;var a=s[2][j][1].split(",");switch(a[0]){case"m_astReward":switch(a[1]){case"ActiveReward":html.push("<td>"+ReadData("<m_ucRewardType>","</m_ucRewardType>")+"</td>");html.push("<td>"+ReadData("<m_iRewardID>","</m_iRewardID>")+"</td>");html.push("<td>"+ReadData("<m_iRewardValue>","</m_iRewardValue>")+"</td>");break;case"MarketActReward":html.push("<td>"+ReadData("<m_ucRewardType>","</m_ucRewardType>")+"</td>");html.push("<td>"+ReadData("<m_ushRewardID>","</m_ushRewardID>")+"</td>");html.push("<td>"+ReadData("<m_iRewardValue>","</m_iRewardValue>")+"</td>");break;}
break;case"m_astSongs":html.push("<td>"+ReadData("<ID>","</ID>")+"</td>");break;}}
break;}}
html.push("</tr>");}
html.push("</table></body></html>");};var html=[];var p=0;WriteDataT(GetBinStructure());return html.join("");}
function MdeToXmlmde(b){if(b.length==0){return"";}
return RTrimBytes(Base64ToBytes(BytesToText(b)),0);}
function XmlmdeToMde(b){if(b.length==0){return"";}
var l=b.length;var n=0;while(true){n+=65536*4;if(l<=n){l=n;break;}}
var d=new Uint8Array(l);d.set(b,0);return TextToBytes(BytesToBase64(d));}
function ImdToTxt(b){if(b.length==0){return"";}
var p=0;var Beat=0;var Action=0;var txt=[];txt.push(BytesToHex(SliceBytes(b,p,p+4)," "));p+=4;Beat=BytesToInt32(SliceBytes(b,p,p+4));txt.push(BytesToHex(SliceBytes(b,p,p+4)," "));p+=4;for(var i=0;i<Beat;i++){txt.push(BytesToHex(SliceBytes(b,p,p+12)," "));p+=12;}
txt.push(BytesToHex(SliceBytes(b,p,p+2)," "));p+=2;Action=BytesToInt32(SliceBytes(b,p,p+4));txt.push(BytesToHex(SliceBytes(b,p,p+4)," "));p+=4;for(var i=0;i<Action;i++){txt.push(BytesToHex(SliceBytes(b,p,p+11)," "));p+=11;}
return txt.join("\r\n");}
function TxtToImd(b){if(b.length==0){return"";}
return HexToBytes(TxtToTxt(b).replace(/\r\n/g,"").replace(/\s+/g,""));}
function ImdToImg(b,o1,o2,o3){if(b.length==0){return"";}
var p=0;var Time=0;var BPM=0;var Beat=0;var Action=0;var Combo=0;var Key=4;var Beats=[];var BPMs=[];var Actions=[];var Timestamps=[];var Tracks=[];var Timespans=[];var BeatLines=[];var BeatLines2=[];var BeatLines4=[];var DeterminePoints=[];var DetermineLines=[];var ReverseTimestamps=[];var ReverseTracks=[];var ComboTimestamps=[];var ComboTracks=[];Time=BytesToInt32(SliceBytes(b,p,p+4));p+=4;Beat=BytesToInt32(SliceBytes(b,p,p+4));p+=4;for(var i=0;i<Beat;i++){Beats.push(BytesToInt32(SliceBytes(b,p,p+4)));p+=4;BPMs.push(BytesToFloat64(SliceBytes(b,p,p+8)));p+=8;}
BPM=MajorityArray(BPMs);p+=2;Action=BytesToInt32(SliceBytes(b,p,p+4));p+=4;for(var i=0;i<Action;i++){Actions.push(BytesToInt32(SliceBytes(b,p,p+2)));Timestamps.push(BytesToInt32(SliceBytes(b,p+2,p+6)));Tracks.push(BytesToInt32(SliceBytes(b,p+6,p+7)));Timespans.push(BytesToInt32(SliceBytes(b,p+7,p+11)));p+=11;}
for(var i=0;i<Actions.length;i++){var t=0;switch(Actions[i]){case 0x00:case 0x02:case 0x62:case 0x22:case 0xA2:t=Tracks[i]+1;break;case 0x01:case 0x61:case 0x21:case 0xA1:t=Tracks[i]+Timespans[i]+1;break;}
if(Key<t){Key=t;}}
for(var i=0;i<Beats.length;i++){if(i<Beats.length-1){var n=(Beats[i+1]-Beats[i])/4;BeatLines.push(Beats[i]);BeatLines4.push(Math.floor(Beats[i]+n));BeatLines2.push(Math.floor(Beats[i]+n*2));BeatLines4.push(Math.floor(Beats[i]+n*3));}
else{BeatLines.push(Beats[i]);}}
for(var i=0;i<Key;i++){DeterminePoints[i]=[];}
for(var i=0;i<Actions.length;i++){switch(Actions[i]){case 0x00:DeterminePoints[Tracks[i]].push(Timestamps[i]);break;case 0x01:case 0xA1:DeterminePoints[Tracks[i]+Timespans[i]].push(Timestamps[i]);break;case 0x21:if(Timespans[i]<0){ReverseTimestamps.push(Timestamps[i]);ReverseTracks.push(Tracks[i]+Timespans[i]);}
break;case 0x02:case 0x62:case 0x22:case 0xA2:var dt;var dn;var di;var dr;var dp;dt=Timestamps[i];do{DeterminePoints[Tracks[i]].push(Math.round(dt));dn=Math.floor(dt*BPM/60000);while(Beats[dn]>dt){dn-=1;}
while(Beats[dn+1]<dt){dn+=1;}
di=(Beats[dn+1]-Beats[dn])/4;dr=Beats[dn+1]-dt;if(dr==0){dn+=1;di=(Beats[dn+1]-Beats[dn])/4;dr=Beats[dn]-dt;}
if(dr>=di){dt+=di;}
else{dt+=dr;dp=1-dr/di;dn+=1;di=(Beats[dn+1]-Beats[dn])/4;dt+=di*dp;}
dt=CloseNumber(dt,Beats[dn],3);dt=CloseNumber(dt,Timestamps[i]+Timespans[i],3);}
while(dt<=Timestamps[i]+Timespans[i]);break;}}
for(var i=0;i<Key;i++){for(var j=0;j<DeterminePoints[i].length;j++){DetermineLines.push(DeterminePoints[i][j]);}}
DetermineLines=UnrepeatArray(DetermineLines).sort(SortNumber);for(var i=0;i<DetermineLines.length;i++){for(var j=0;j<Key;j++){if(DeterminePoints[j].indexOf(DetermineLines[i])!=-1){ComboTimestamps.push(DetermineLines[i]);ComboTracks.push(j);}}}
for(var i=0;i<ComboTimestamps.length;i++){var n=ReverseTimestamps.indexOf(ComboTimestamps[i]);if((n!=-1)&&(ReverseTracks[n]==ComboTracks[i])){var t=ComboTracks[i];ComboTracks[i]=ComboTracks[i+1];ComboTracks[i+1]=t;i+=1;}}
Combo=ComboTimestamps.length;var ScaleX=parseFloat(o3[0]);var ScaleY=parseFloat(o3[1]);var PaddingTop=128*ScaleX;var PaddingBottom=64*ScaleX;var PaddingLeft=64*ScaleX;var PaddingRight=64*ScaleX;var CoreWidth=128*ScaleX;var SpeedRate=Math.ceil(Time/(32767-PaddingTop-PaddingBottom));var SplitHeight=PaddingTop+Time/SpeedRate+PaddingBottom;if(ScaleY!=0){SpeedRate=2400/CoreWidth/ScaleX/ScaleY;}
else{ScaleY=2400/CoreWidth/ScaleX/SpeedRate;}
var CoreHeight=Time/SpeedRate;var WholeWidth=PaddingLeft+CoreWidth+PaddingRight;var WholeHeight=PaddingTop+CoreHeight+PaddingBottom;var SplitCount=Math.ceil(WholeHeight/SplitHeight);var NoteWidth=Math.round(CoreWidth/Key*(105-5*Key)/100);var NoteHeight=CoreWidth/16;var TouchNoteStyle="#0000FF";var HoldNoteStyle="#00FF00";var StrokeWidth=CoreWidth/32;var StrokeStyle="#00FF00";var ArrowStyle="#00FF00";var BackgroundStyle="#FFFFFF";var FrameStokeWidth=1*ScaleX;var FrameStokeStyle="#000000";var TrackLineWidth=0.24*ScaleX;var TrackLineStyle="#00FFFF";var BeatLineWidth=0.24*ScaleX;var BeatLineStyle="#000000";var DetermineLineWidth=0.24*ScaleX;var DetermineLineStyle="#FF0000";var DeterminePointRadius=NoteHeight/2;var DeterminePointStyle="#FF00FF";var TextStyle="#000000";var TextFont="12px Arial";var BoldTextFont="14px 微软雅黑 bold";var cvs=[];var ctx=[];for(var i=0;i<SplitCount;i++){cvs[i]=document.createElement("canvas");cvs[i].style.display="none";cvs[i].width=WholeWidth;cvs[i].height=((i!=SplitCount-1)?SplitHeight:((WholeHeight==SplitHeight)?WholeHeight:(WholeHeight%SplitHeight)));ctx[i]=cvs[i].getContext("2d");}
var DrawLine=function(x1,y1,x2,y2,w,s,t){var i1;var i2;if(y1>y2){i1=Math.floor(y2/SplitHeight);i2=Math.floor(y1/SplitHeight);}
else if(y1<y2){i1=Math.floor(y1/SplitHeight);i2=Math.floor(y2/SplitHeight);}
else{i1=Math.floor((y1-w/2)/SplitHeight);i2=Math.floor((y2+w/2)/SplitHeight);}
if(i1<0){i1=0;}
if(i2>SplitCount-1){i2=SplitCount-1;}
for(var i=i1;i<i2+1;i++){switch(t){case 1:ctx[i].beginPath();ctx[i].moveTo(Math.round(x1),Math.round(y1-SplitHeight*i));ctx[i].lineTo(Math.round(x2),Math.round(y2-SplitHeight*i));ctx[i].lineWidth=w;ctx[i].strokeStyle=s;ctx[i].stroke();break;case 2:ctx[i].beginPath();var n=Math.ceil(Math.sqrt(Math.pow(x1-x2,2)+Math.pow(y1-y2,2))/20);var x=Math.min(x1,x2);var xs=Math.abs(x1-x2)/(n*2+1);var y=Math.min(y1,y2);var ys=Math.abs(y1-y2)/(n*2+1);for(var j=0;j<n+1;j++){ctx[i].moveTo(Math.round(x),Math.round(y-SplitHeight*i));x+=xs;y+=ys;ctx[i].lineTo(Math.round(x),Math.round(y-SplitHeight*i));x+=xs;y+=ys;}
ctx[i].lineWidth=w;ctx[i].strokeStyle=s;ctx[i].stroke();break;case 4:ctx[i].beginPath();var n=Math.ceil(Math.sqrt(Math.pow(x1-x2,2)+Math.pow(y1-y2,2))/10);var x=Math.min(x1,x2);var xs=Math.abs(x1-x2)/(n*2+1);var y=Math.min(y1,y2);var ys=Math.abs(y1-y2)/(n*2+1);for(var j=0;j<n+1;j++){ctx[i].moveTo(Math.round(x),Math.round(y-SplitHeight*i));x+=xs;y+=ys;ctx[i].lineTo(Math.round(x),Math.round(y-SplitHeight*i));x+=xs;y+=ys;}
ctx[i].lineWidth=w;ctx[i].strokeStyle=s;ctx[i].stroke();break;}}};var DrawPoint=function(x,y,r,s){var i1=Math.floor((y-r)/SplitHeight);var i2=Math.floor((y+r)/SplitHeight);if(i1<0){i1=0;}
if(i2>SplitCount-1){i2=SplitCount-1;}
for(var i=i1;i<i2+1;i++){ctx[i].beginPath();ctx[i].arc(Math.round(x),Math.round(y-SplitHeight*i),r,0,Math.PI*2);s=ctx[i].createRadialGradient(Math.round(x),Math.round(y-SplitHeight*i),r/8,Math.round(x),Math.round(y-SplitHeight*i),r);s.addColorStop(0,"#FFCCCC");s.addColorStop(0.5,"#FF6666");s.addColorStop(1,"#FF0000");ctx[i].fillStyle=s;ctx[i].fill();}};var DrawText=function(x,y,t,s,f,a){var n=GetFontSize(f)*ScaleX;var i1=Math.floor((y-n)/SplitHeight);var i2=Math.floor((y+n)/SplitHeight);if(i1<0){i1=0;}
if(i2>SplitCount-1){i2=SplitCount-1;}
for(var i=i1;i<i2+1;i++){ctx[i].fillStyle=s;ctx[i].font=SetFontSize(f,n);ctx[i].textAlign=a;ctx[i].fillText(t,Math.round(x),Math.round(y-SplitHeight*i));}};var DrawNote=function(a,x,y){var i1=Math.floor((y-NoteHeight/2)/SplitHeight);var i2=Math.floor((y+NoteHeight/2)/SplitHeight);if(i1<0){i1=0;}
if(i2>SplitCount-1){i2=SplitCount-1;}
for(var i=i1;i<i2+1;i++){switch(a){case 0:ctx[i].fillStyle=TouchNoteStyle;break;default:ctx[i].fillStyle=HoldNoteStyle;break;}
ctx[i].fillRect(Math.round(x-NoteWidth/2),Math.round(y-SplitHeight*i-NoteHeight/2),NoteWidth,NoteHeight);}};var DrawStroke=function(x1,y1,x2,y2){DrawLine(Math.round(x1),Math.round(y1),Math.round(x2),Math.round(y2),StrokeWidth,StrokeStyle,1);};var DrawArrow=function(t,x,y){var i1=Math.floor((y-StrokeWidth)/SplitHeight);var i2=Math.floor((y+StrokeWidth)/SplitHeight);if(i1<0){i1=0;}
if(i2>SplitCount-1){i2=SplitCount-1;}
for(var i=i1;i<i2+1;i++){ctx[i].beginPath();if(t<0){ctx[i].moveTo(Math.round(x+StrokeWidth/2),Math.round(y-SplitHeight*i+StrokeWidth));ctx[i].lineTo(Math.round(x+StrokeWidth/2),Math.round(y-SplitHeight*i-StrokeWidth));ctx[i].lineTo(Math.round(x+StrokeWidth/2-StrokeWidth*2),Math.round(y-SplitHeight*i));}
else if(t>0){ctx[i].moveTo(Math.round(x-StrokeWidth/2),Math.round(y-SplitHeight*i+StrokeWidth));ctx[i].lineTo(Math.round(x-StrokeWidth/2),Math.round(y-SplitHeight*i-StrokeWidth));ctx[i].lineTo(Math.round(x-StrokeWidth/2+StrokeWidth*2),Math.round(y-SplitHeight*i));}
ctx[i].closePath();ctx[i].lineWidth=1;ctx[i].fillStyle=ArrowStyle;ctx[i].fill();}};var DrawKey=function(Action,Timestamp,Track,Timespan){switch(Action){case 0x00:DrawNote(Action,CoreWidth/Key*(Track+0.5)+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom);break;case 0x01:DrawNote(Action,CoreWidth/Key*(Track+0.5)+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom);if(Timespan<0){DrawStroke(CoreWidth/Key*(Track+0.5+Timespan)+StrokeWidth/2+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom,CoreWidth/Key*(Track+0.5)-NoteWidth/2+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom);DrawArrow(Timespan,CoreWidth/Key*(Track+0.5+Timespan)+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom);}
else if(Timespan>0){DrawStroke(CoreWidth/Key*(Track+0.5)+NoteWidth/2+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom,CoreWidth/Key*(Track+0.5+Timespan)-StrokeWidth/2+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom);DrawArrow(Timespan,CoreWidth/Key*(Track+0.5+Timespan)+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom);}
break;case 0x02:DrawNote(Action,CoreWidth/Key*(Track+0.5)+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom);DrawStroke(CoreWidth/Key*(Track+0.5)+PaddingLeft,WholeHeight-Timestamp/SpeedRate-NoteHeight/2-PaddingBottom,CoreWidth/Key*(Track+0.5)+PaddingLeft,WholeHeight-Timestamp/SpeedRate-Timespan/SpeedRate+StrokeWidth/2-PaddingBottom);DrawStroke(CoreWidth/Key*(Track+0.5)-StrokeWidth+PaddingLeft,WholeHeight-Timestamp/SpeedRate-Timespan/SpeedRate-PaddingBottom,CoreWidth/Key*(Track+0.5)+StrokeWidth+PaddingLeft,WholeHeight-Timestamp/SpeedRate-Timespan/SpeedRate-PaddingBottom);break;case 0x61:DrawNote(Action,CoreWidth/Key*(Track+0.5)+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom);if(Timespan<0){DrawStroke(CoreWidth/Key*(Track+0.5+Timespan)-StrokeWidth/2+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom,CoreWidth/Key*(Track+0.5)-NoteWidth/2+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom);}
else if(Timespan>0){DrawStroke(CoreWidth/Key*(Track+0.5)+NoteWidth/2+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom,CoreWidth/Key*(Track+0.5+Timespan)+StrokeWidth/2+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom);}
break;case 0x62:DrawNote(Action,CoreWidth/Key*(Track+0.5)+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom);DrawStroke(CoreWidth/Key*(Track+0.5)+PaddingLeft,WholeHeight-Timestamp/SpeedRate-NoteHeight/2-PaddingBottom,CoreWidth/Key*(Track+0.5)+PaddingLeft,WholeHeight-Timestamp/SpeedRate-Timespan/SpeedRate+StrokeWidth/2-PaddingBottom);break;case 0x21:if(Timespan<0){DrawStroke(CoreWidth/Key*(Track+0.5+Timespan)-StrokeWidth/2+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom,CoreWidth/Key*(Track+0.5)+StrokeWidth/2+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom);}
else if(Timespan>0){DrawStroke(CoreWidth/Key*(Track+0.5)-StrokeWidth/2+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom,CoreWidth/Key*(Track+0.5+Timespan)+StrokeWidth/2+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom);}
break;case 0x22:DrawStroke(CoreWidth/Key*(Track+0.5)+PaddingLeft,WholeHeight-Timestamp/SpeedRate-StrokeWidth/2-PaddingBottom,CoreWidth/Key*(Track+0.5)+PaddingLeft,WholeHeight-Timestamp/SpeedRate-Timespan/SpeedRate+StrokeWidth/2-PaddingBottom);break;case 0xA1:if(Timespan<0){DrawStroke(CoreWidth/Key*(Track+0.5+Timespan)+StrokeWidth/2+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom,CoreWidth/Key*(Track+0.5)+StrokeWidth/2+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom);DrawArrow(Timespan,CoreWidth/Key*(Track+0.5+Timespan)+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom);}
else if(Timespan>0){DrawStroke(CoreWidth/Key*(Track+0.5)-StrokeWidth/2+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom,CoreWidth/Key*(Track+0.5+Timespan)-StrokeWidth/2+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom);DrawArrow(Timespan,CoreWidth/Key*(Track+0.5+Timespan)+PaddingLeft,WholeHeight-Timestamp/SpeedRate-PaddingBottom);}
break;case 0xA2:DrawStroke(CoreWidth/Key*(Track+0.5)+PaddingLeft,WholeHeight-Timestamp/SpeedRate-StrokeWidth/2-PaddingBottom,CoreWidth/Key*(Track+0.5)+PaddingLeft,WholeHeight-Timestamp/SpeedRate-Timespan/SpeedRate+StrokeWidth/2-PaddingBottom);DrawStroke(CoreWidth/Key*(Track+0.5)-StrokeWidth+PaddingLeft,WholeHeight-Timestamp/SpeedRate-Timespan/SpeedRate-PaddingBottom,CoreWidth/Key*(Track+0.5)+StrokeWidth+PaddingLeft,WholeHeight-Timestamp/SpeedRate-Timespan/SpeedRate-PaddingBottom);break;}};if(o1[0]){for(var i=0;i<SplitCount;i++){ctx[i].fillStyle=BackgroundStyle;ctx[i].fillRect(0,0,cvs[i].width,cvs[i].height);}}
for(var i=0;i<SplitCount;i++){ctx[i].globalAlpha=0.618;}
if(o1[1]){for(var i=0;i<Key+1;i++){DrawLine(CoreWidth/Key*i+PaddingLeft,WholeHeight-PaddingBottom,CoreWidth/Key*i+PaddingLeft,PaddingTop,TrackLineWidth,TrackLineStyle,1);DrawLine(CoreWidth/Key*i+PaddingLeft,WholeHeight-PaddingBottom,CoreWidth/Key*i+PaddingLeft,PaddingTop,TrackLineWidth,TrackLineStyle,1);}}
if(o1[2]){DrawLine(0,1,0,WholeHeight-1,FrameStokeWidth,FrameStokeStyle,1);DrawLine(WholeWidth,1,WholeWidth,WholeHeight-2,FrameStokeWidth,FrameStokeStyle,1);DrawLine(0,0,WholeWidth,0,FrameStokeWidth,FrameStokeStyle,1);DrawLine(0,WholeHeight-1,WholeWidth,WholeHeight-1,FrameStokeWidth,FrameStokeStyle,1);}
if(o2[0]){for(var i=0;i<BeatLines.length;i++){DrawLine(0,WholeHeight-BeatLines[i]/SpeedRate-BeatLineWidth/2-PaddingBottom,WholeWidth,WholeHeight-BeatLines[i]/SpeedRate-BeatLineWidth/2-PaddingBottom,BeatLineWidth,BeatLineStyle,1);DrawText(0,WholeHeight-1-BeatLines[i]/SpeedRate-BeatLineWidth/2-PaddingBottom,Math.round(BeatLines[i]).toString(),BeatLineStyle,TextFont,"left");}
for(var i=0;i<BeatLines2.length;i++){DrawLine(0,WholeHeight-BeatLines2[i]/SpeedRate-BeatLineWidth/2-PaddingBottom,WholeWidth,WholeHeight-BeatLines2[i]/SpeedRate-BeatLineWidth/2-PaddingBottom,BeatLineWidth,BeatLineStyle,2);DrawText(0,WholeHeight-1-BeatLines2[i]/SpeedRate-BeatLineWidth/2-PaddingBottom,Math.round(BeatLines2[i]).toString(),BeatLineStyle,TextFont,"left");}
for(var i=0;i<BeatLines4.length;i++){DrawLine(0,WholeHeight-BeatLines4[i]/SpeedRate-BeatLineWidth/2-PaddingBottom,WholeWidth,WholeHeight-BeatLines4[i]/SpeedRate-BeatLineWidth/2-PaddingBottom,BeatLineWidth,BeatLineStyle,4);DrawText(0,WholeHeight-1-BeatLines4[i]/SpeedRate-BeatLineWidth/2-PaddingBottom,Math.round(BeatLines4[i]).toString(),BeatLineStyle,TextFont,"left");}}
for(var i=0;i<Actions.length;i++){DrawKey(Actions[i],Timestamps[i],Tracks[i],Timespans[i])}
if(o2[2]){for(var i=0;i<DetermineLines.length;i++){DrawLine(0,WholeHeight-DetermineLines[i]/SpeedRate-DetermineLineWidth/2-PaddingBottom,WholeWidth,WholeHeight-DetermineLines[i]/SpeedRate-DetermineLineWidth/2-PaddingBottom,DetermineLineWidth,DetermineLineStyle,1);DrawText(WholeWidth,WholeHeight-1-DetermineLines[i]/SpeedRate-DetermineLineWidth/2-PaddingBottom,Math.round(DetermineLines[i]).toString(),DetermineLineStyle,TextFont,"right");}}
if(o2[1]){for(var i=0;i<ComboTimestamps.length;i++){DrawPoint(CoreWidth/Key*(ComboTracks[i]+0.5)+PaddingLeft,WholeHeight-ComboTimestamps[i]/SpeedRate-PaddingBottom,DeterminePointRadius,DeterminePointStyle);DrawText(CoreWidth/Key*(ComboTracks[i]+0.5)+PaddingLeft,WholeHeight-ComboTimestamps[i]/SpeedRate-PaddingBottom-NoteHeight/2,(i+1).toString(),DeterminePointStyle,TextFont,"center");}}
DrawText(WholeWidth/2,18*ScaleX,FileName+"."+FileExtension,TextStyle,BoldTextFont,"center");DrawText(0+PaddingLeft/1.3,38*ScaleX,"时间："+MillisecondToTime(Time).toString(),TextStyle,TextFont,"left");DrawText(WholeWidth-CoreWidth/2-PaddingRight/1.3,38*ScaleX,"拍速："+BPM.toString(),TextStyle,TextFont,"left");DrawText(0+PaddingLeft/1.3,56*ScaleX,"节拍："+Beat.toString(),TextStyle,TextFont,"left");DrawText(WholeWidth-CoreWidth/2-PaddingRight/1.3,56*ScaleX,"动作："+Action.toString(),TextStyle,TextFont,"left");DrawText(0+PaddingLeft/1.3,74*ScaleX,"音符："+Combo.toString(),TextStyle,TextFont,"left");DrawText(WholeWidth-CoreWidth/2-PaddingRight/1.3,74*ScaleX,"键位："+Key.toString(),TextStyle,TextFont,"left");DrawText(0+PaddingLeft/1.3,92*ScaleX,"满分："+ComboToScore(Combo).toString(),TextStyle,TextFont,"left");DrawText(WholeWidth-CoreWidth/2-PaddingRight/1.3,92*ScaleX,"速率："+ScaleY.toString(),TextStyle,TextFont,"left");DrawText(WholeWidth/2,WholeHeight-48*ScaleX,"Draw by rmstZ.html",TextStyle,TextFont,"center");DrawText(WholeWidth/2,WholeHeight-30*ScaleX,"in "+GetDateTime(),TextStyle,TextFont,"center");DrawText(WholeWidth/2,WholeHeight-10*ScaleX,"Copyright © 心のsky Group",TextStyle,BoldTextFont,"center");var src=[];for(var i=0;i<SplitCount;i++){src[i]=cvs[i].toDataURL("image/png");}
return src;}
function ImdToHtml(b,o1,o2,o3){var s=ImdToImg(b,o1,o2,o3);var html=[];html.push("<html><head><title>"+FileName+"."+FileExtension+"</title><style type="+'"'+"text/css"+'"'+">div{text-align:center;}</style></head><body>");for(var i=0;i<s.length;i++){html.push("<div><img src="+'"'+s[i]+'"'+"/></div>");}
html.push("</body></html>");return html.join("");}
function ImgToPng(b,s){if(b.length==0){return"";}
var a=s.split("×");var w=a[0];var h=a[1];var img=document.createElement("img");img.style.display="none";img.src=GetImgSrc(b);var cvs=document.createElement("canvas");cvs.style.display="none";cvs.width=w;cvs.height=h;var ctx=cvs.getContext("2d");if(img.width/img.height>=w/h){var r=h/img.height;ctx.drawImage(img,(img.width-w/r)/2,0,w/r,h/r,0,0,w,h);}
else{var r=w/img.width;ctx.drawImage(img,0,(img.height-h/r)/2,w/r,h/r,0,0,w,h);}
return cvs.toDataURL("image/png");;}
function Mp3ToImd(b){if(b.length==0){return"";}
window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;var ctx=new AudioContext();var bf=ctx.createBuffer(b.buffer,false);return bf.getChannelData(0);var visualize=function(ctx,bf){var bs=ctx.createBufferSource();var as=ctx.createAnalyser();bs.connect(as);as.connect(ctx.destination);bs.buffer=bf;if(!bs.start){bs.start=bs.noteOn
bs.stop=bs.noteOff}
bs.start(0);this.status=1;this.source=bs;var fd=new Uint8Array(as.frequencyBinCount);as.getByteFrequencyData(fd);var td=new Uint8Array(as.fftSize);as.getByteTimeDomainData(td);return;};ctx.decodeAudioData(b.buffer,function(bf){visualize(ctx,bf);},function(e){alert(e.toString());});}</script><script type="text/javascript">function HideOperate(){document.getElementById("divOperateBin").style.display="none";document.getElementById("divOperateXml").style.display="none";document.getElementById("divOperateImd").style.display="none";document.getElementById("divSelectImd").style.display="none";document.getElementById("divSelectTxt").style.display="none";document.getElementById("divOperateImg").style.display="none";document.getElementById("divSave").style.display="none";document.getElementById("divResult").innerHTML="";}
function HideOption(){var Hide=function(t){switch(t){case"png":document.getElementById("divOptionImd1").style.display="block";document.getElementById("divOptionImd2").style.display="block";document.getElementById("divOptionImd3").style.display="none";break;case"html":document.getElementById("divOptionImd1").style.display="block";document.getElementById("divOptionImd2").style.display="block";document.getElementById("divOptionImd3").style.display="block";break;default:document.getElementById("divOptionImd1").style.display="none";document.getElementById("divOptionImd2").style.display="none";document.getElementById("divOptionImd3").style.display="none";}}
switch(FileExtension){case"imd":Hide(GetSelectValue("selectImdMode"));break;case"txt":Hide(GetSelectValue("selectTxtMode"));break;}}
function ShowText(s,d,e,t){if(!IsUCBrowser&&(d.length!=0)){var a=document.getElementById("aSave");a.href=URL.createObjectURL(new Blob([d],{"type":t}));a.download=FileName+"."+e;document.getElementById("divSave").style.display="block";}
if((FileExtension=="bin")&&(d.length==0)){document.getElementById("divOperateBin").style.display="none";document.getElementById("divOperateXml").style.display="none";alert("目前不支持 "+OptimizeName()+" 。");return;}
var p=document.createElement("p");p.style.textAlign="left";p.style.fontSize="14px";p.innerHTML=TextToHtml(s).replace(/\r\n/g,"<br/>");document.getElementById("divResult").appendChild(p);}
function ShowBin(s,d,e,t){if(!IsUCBrowser&&(d.length!=0)){var a=document.getElementById("aSave");a.href=URL.createObjectURL(new Blob([d],{"type":t}));a.download=FileName+"."+e;document.getElementById("divSave").style.display="block";}
if(document.getElementById("divSave").style.display=="none"){document.getElementById("divOperateXml").style.display="none";}
var p=document.createElement("p");p.style.textAlign="left";p.style.fontSize="14px";p.innerHTML=TextToHtml(s).replace(/\r\n/g,"<br/>");document.getElementById("divResult").appendChild(p);}
function ShowHtml(d,e,t){if(!IsUCBrowser&&(d.length!=0)){var a=document.getElementById("aSave");a.href=URL.createObjectURL(new Blob([TextToBytes(d)],{"type":t}));a.download=FileName+"."+e;document.getElementById("divSave").style.display="block";}
if((FileExtension=="bin")&&(d.length==0)){document.getElementById("divOperateBin").style.display="none";document.getElementById("divOperateXml").style.display="none";alert("目前不支持 "+OptimizeName(FileName)+" 。");return;}
var iframe=document.createElement("iframe");iframe.onload=function(){var c=this.contentDocument;if(this!=null&&c!=null){this.style.border="none";this.width="100%";this.height=c.body.scrollHeight+17;this.style.display="block";}};iframe.style.display="none";iframe.src=a.href;document.getElementById("divResult").appendChild(iframe);}
function ShowImg(d,e,t){if(!IsUCBrowser&&(d.length!=0)){var a=document.getElementById("aSave");a.href=URL.createObjectURL(new Blob([Base64ToBytes(d.split(",")[1])],{"type":t}));a.download=FileName+"."+e;document.getElementById("divSave").style.display="block";}
var img=document.createElement("img");img.src=d;document.getElementById("divResult").appendChild(img);}
function ShowAudio(d,e){return;var l=[];for(var i=0;i<100000;i++){if(d[i].toString()!="0"){l.push(d[i].toString()+","+i.toString());}}
alert(l.length);d=l.join("</br>");document.write(d);return;if(!IsUCBrowser&&(d.length!=0)){var a=document.getElementById("aSave");a.href=URL.createObjectURL(new Blob([d],{"type":t}));a.download=FileName+"."+e;document.getElementById("divSave").style.display="block";}
return;}
function ReadBuffer(){HideOperate();switch(FileExtension){case"bin":document.getElementById("divOperateBin").style.display="block";switch(GetSelectValue("selectBinMode")){case"xml":var t=BinToXmlbin(FileBuffer);ShowText(t,TextToBytes(t),"xml","text/html");break;case"html":ShowHtml(BinToHtml(FileBuffer),"html","text/html");break;}
break;case"xml":switch(FileType){case"bin":document.getElementById("divOperateXml").style.display="block";switch(GetSelectValue("selectXmlbinMode")){case"bin":ShowBin(TxtToTxt(FileBuffer),XmlbinToBin(FileBuffer),"bin","application/octet-binary");break;case"html":ShowHtml(XmlbinToHtml(FileBuffer),"html","text/html");break;}
break;case"mde":ShowText(TxtToTxt(FileBuffer),XmlmdeToMde(FileBuffer),"mde","text/html");break;}
break;case"mde":var t=MdeToXmlmde(FileBuffer);ShowText(BytesToText(t),t,"xml","text/html");break;case"imd":document.getElementById("divOperateImd").style.display="block";document.getElementById("divSelectImd").style.display="block";HideOption();switch(GetSelectValue("selectImdMode")){case"png":if(!SupportCanvasAPI){alert("当前浏览器内核不支持Canvas API。");return;}
ShowImg(ImdToImg(FileBuffer,new Array(document.getElementById("inputDrawBackground").checked,document.getElementById("inputDrawTrack").checked,document.getElementById("inputDrawFrame").checked),new Array(document.getElementById("inputDrawBeat").checked,document.getElementById("inputDrawCombo").checked,document.getElementById("inputDrawDetermine").checked),new Array("1","0"))[0],"png","image/png");break;case"html":ShowHtml(ImdToHtml(FileBuffer,new Array(document.getElementById("inputDrawBackground").checked,document.getElementById("inputDrawTrack").checked,document.getElementById("inputDrawFrame").checked),new Array(document.getElementById("inputDrawBeat").checked,document.getElementById("inputDrawCombo").checked,document.getElementById("inputDrawDetermine").checked),new Array(GetSelectValue("selectImdScaleX"),GetSelectValue("selectImdScaleY"))),"html","text/html");break;case"txt":var t=ImdToTxt(FileBuffer);ShowText(t,TextToBytes(t),"txt","text/plain");break;}
break;case"txt":document.getElementById("divOperateImd").style.display="block";document.getElementById("divSelectTxt").style.display="block";HideOption();switch(GetSelectValue("selectTxtMode")){case"png":if(!SupportCanvasAPI){alert("当前浏览器内核不支持Canvas API。");return;}
ShowImg(ImdToImg(TxtToImd(FileBuffer),new Array(document.getElementById("inputDrawBackground").checked,document.getElementById("inputDrawTrack").checked,document.getElementById("inputDrawFrame").checked),new Array(document.getElementById("inputDrawBeat").checked,document.getElementById("inputDrawCombo").checked,document.getElementById("inputDrawDetermine").checked),new Array("1","0"))[0],"png","image/png");break;case"html":ShowHtml(ImdToHtml(TxtToImd(FileBuffer),new Array(document.getElementById("inputDrawBackground").checked,document.getElementById("inputDrawTrack").checked,document.getElementById("inputDrawFrame").checked),new Array(document.getElementById("inputDrawBeat").checked,document.getElementById("inputDrawCombo").checked,document.getElementById("inputDrawDetermine").checked),new Array(GetSelectValue("selectImdScaleX"),GetSelectValue("selectImdScaleY"))),"html","text/html");break;case"imd":ShowText(TxtToTxt(FileBuffer),TxtToImd(FileBuffer),"imd","application/octet-binary");break;}
break;case"bmp":case"jpg":case"gif":case"png":if(!SupportCanvasAPI){alert("当前浏览器内核不支持Canvas API。");return;}
document.getElementById("divOperateImg").style.display="block";if(SelectCount==0){var v=GetImgSize(FileBuffer);var s=document.getElementById("selectImgMode");for(var i=0;i<s.children.length;i++){if(s.children[i].value==v){s.selectedIndex=i;break;}}}
ShowImg(ImgToPng(FileBuffer,GetSelectValue("selectImgMode")),"png","image/png");case"mp3":if(!SupportCanvasAPI){alert("当前浏览器内核不支持Canvas API。");return;}
if(!SupportAudioAPI){alert("当前浏览器内核不支持Audio API。");return;}
ShowAudio(Mp3ToImd(FileBuffer),"imd","application/octet-binary");break;default:var t=TxtToTxt(FileBuffer);ShowText(t,TextToBytes(t),FileExtension,"text/plain");}}
function ReadFile(e){if(!SupportFileAPI){alert("当前浏览器内核不支持File API。");return;}
var r=new FileReader();r.onload=function(){FileBuffer=new Uint8Array(this.result);FileType=GetFileType(FileExtension,FileBuffer);SelectCount=0;ReadBuffer();};FileName=GetFileName(e.target.files[0].name);FileExtension=GetFileExtension(e.target.files[0].name);r.readAsArrayBuffer(e.target.files[0]);}
function SelectChanged(){HideOption();SelectCount+=1;ReadBuffer();}
function CheckChanged(){ReadBuffer();}
var FileName;var FileExtension;var FileType;var FileBuffer;var SelectCount;</script></body></html>